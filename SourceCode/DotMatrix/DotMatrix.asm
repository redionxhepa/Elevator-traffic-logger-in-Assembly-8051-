CLK BIT P1.7
CS BIT P1.6
DIN BIT P1.5


SPEED EQU 38h
BRIGHT EQU 3Ah


WADDR EQU 30h
WDATA EQU 31h

ORG 0000h







CONFIGURE:
MOV WADDR, #00h
MOV WDATA, #00h  ;nop

MOV R2,#8
QWERTY:
ACALL SEND

DJNZ R2, QWERTY

SETB CS
CLR CS


MOV WADDR, #09h
MOV WDATA, #00h  ;decoding BCD
;CLR CS
ACALL SEND
SETB CS
nop
CLR CS

MOV DPTR, #BRIGHTNESS
MOV A, BRIGHT
MOVC A, @A+DPTR

MOV WADDR, #0Ah
MOV WDATA, A  ;brightness 
;CLR CS
ACALL SEND
SETB CS
nop
CLR CS

MOV WADDR, #0bh
MOV WDATA, #07h  ;scanlimitï¼8 LEDs
;CLR CS
ACALL SEND
SETB CS
nop
CLR CS

MOV WADDR, #0ch
MOV WDATA, #01h  ;power-down modeï¼0ï¼normal modeï¼1
;CLR CS
ACALL SEND
SETB CS
nop
CLR CS

MOV WADDR, #0fh
MOV WDATA, #00h  ;test displayï¼1ï¼EOTï¼displayï¼0
;CLR CS
ACALL SEND
SETB CS
nop
CLR CS


MOV WADDR, #00h
MOV WDATA, #00h  ;nop
ACALL SEND
SETB CS
nop
CLR CS

ACALL SEND
SETB CS
nop
CLR CS

ACALL SEND
SETB CS
nop
CLR CS

ACALL SEND
SETB CS
nop
CLR CS

ACALL SEND
SETB CS
nop
CLR CS

ACALL SEND
SETB CS
nop
CLR CS

ACALL SEND
SETB CS
nop
CLR CS

RET

SEND:
;CLR CS

MOV A, WADDR

MOV R4, #8
FIRST:
RLC A
MOV DIN, C
SETB CLK
CLR CLK
DJNZ r4, FIRST

MOV A, WDATA

MOV R4, #8
SECOND:
RLC A
MOV DIN, C
SETB CLK
CLR CLK
DJNZ r4, SECOND

RET


BRIGHTNESS:
 DB 00h, 02h, 03h, 05h, 07h, 08h, 09h, 0Bh, 0Dh, 0Fh
 
END